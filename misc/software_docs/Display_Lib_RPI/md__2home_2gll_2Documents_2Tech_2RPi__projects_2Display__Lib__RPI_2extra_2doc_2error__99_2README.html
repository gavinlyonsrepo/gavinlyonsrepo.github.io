<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Display_Lib_RPI: Error 99 Readme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Display_Lib_RPI<span id="projectnumber">&#160;2.4.2</span>
   </div>
   <div id="projectbrief">A C++ Library to connect electronic displays to Linux single board computers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Error 99 Readme</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="error-99-readme"></a> </p>
<h1><a class="anchor" id="problem"></a>
Problem</h1>
<p>If the user tries to write an SPI buffer bigger than the computers maximum SPI write buffer size you will get 'Error 99' message in console. To fix you need to increase your computers maximum SPI write buffer size. Also make sure SPI is enabled on your computer.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Device or library   </th><th class="markdownTableHeadNone">maximum SPI transaction size bytes   </th><th class="markdownTableHeadNone">where defined    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lgpio   </td><td class="markdownTableBodyNone">65536   </td><td class="markdownTableBodyNone">LG_MAX_SPI_DEVICE_COUNT in lgpio.h    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Display_lib_RPI   </td><td class="markdownTableBodyNone">2 &lt;-&gt; 65536(default)   </td><td class="markdownTableBodyNone">Display_SPI_BLK_SIZE    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Raspberry pis   </td><td class="markdownTableBodyNone">set same or bigger as Display_SPI_BLK_SIZE   </td><td class="markdownTableBodyNone">/boot/firmware/cmdline.txt spidev.bufsiz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">other SBC   </td><td class="markdownTableBodyNone">set same or bigger as Display_SPI_BLK_SIZE   </td><td class="markdownTableBodyNone">???   </td></tr>
</table>
<p>The maximum SPI transaction size that low level dependency 'lgpio' can handle by default is 65536 bytes.(see LG_MAX_SPI_DEVICE_COUNT in lgpio.h) So this is also the maximum transaction size of Display_lib_RPI, if more than that needs to be sent it is sent in blocks of Display_SPI_BLK_SIZE(default 65536) bytes. Certain color 16-bit 'Display_lib_RPI' functions use buffered writes, the ones that draw bitmaps, write fonts, fill rectangles, clear screen, etc. User can also change and view maximum SPI transaction size( Display_SPI_BLK_SIZE) of 'Display_lib_RPI' by using getDisplaySPIBlockSize() and setDisplaySPIBlockSize() functions, by default it is 65536. Due not set it higher than this or 'lgppio' will give an spi Write error. In order for buffered writes to work the spidev buffer size of users computer must be bigger than or equal Display_SPI_BLK_SIZE(max and default 65536), but no bigger than 65536. The maximum size of buffer will vary by display screen size( for example ST7735 with 128x128 pixel size screen = 32768)</p>
<h1><a class="anchor" id="fix"></a>
Fix</h1>
<p><em>On Raspberry Pi's SBC</em></p>
<p>spidev bufsiz defines the number of bytes that the SPI driver will use as a buffer for data transfers. To check the spidev buf size setting on your device run command:</p>
<div class="fragment"><div class="line">cat /sys/module/spidev/parameters/bufsiz</div>
</div><!-- fragment --><p>If it is lower than 65536(or value indicated by Error 99 message report) you can change it by adding this to the start of line in file /boot/firmware/cmdline.txt. Make sure everything is on one line and there is space ' ' between this parameter and next one. Then reboot machine. Verify again by running last cat command above(after reboot)</p>
<div class="fragment"><div class="line">spidev.bufsiz=65536</div>
</div><!-- fragment --><h1><a class="anchor" id="software-spi"></a>
Software SPI</h1>
<p>Alternately you can use software SPI which is not affected by these settings but can be slower. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
