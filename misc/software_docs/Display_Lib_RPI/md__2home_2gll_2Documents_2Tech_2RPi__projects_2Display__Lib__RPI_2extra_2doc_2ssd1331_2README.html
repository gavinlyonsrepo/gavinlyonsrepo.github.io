<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Display_Lib_RPI: SSD1331 OLED Readme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Display_Lib_RPI<span id="projectnumber">&#160;2.3.0</span>
   </div>
   <div id="projectbrief">A C++ Library to connect electronic displays to Linux single board computers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SSD1331 OLED Readme</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="ssd1331-oled-readme"></a> </p>
<h1><a class="anchor" id="table-of-contents-9"></a>
Table of contents</h1>
<ul>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ch1115_2README.html#overview">Overview</a></li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ch1115_2README.html#software">Software</a><ul>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ili9341_2README.html#user-options">User Options</a></li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ili9341_2README.html#file-system">File system</a></li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ili9341_2README.html#bitmap">Bitmap</a></li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ili9341_2README.html#color-codes">Color codes</a></li>
</ul>
</li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ch1115_2README.html#hardware">Hardware</a></li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ch1115_2README.html#output">Output</a></li>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ili9341_2README.html#notes">Notes</a><ul>
<li><a class="el" href="md__2home_2gll_2Documents_2Tech_2RPi__projects_2Display__Lib__RPI_2extra_2doc_2ili9341_2README.html#spidev-buf-size">spidev buf size</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="overview-9"></a>
Overview</h1>
<ul>
<li>Name: SSD1331</li>
<li>Description:</li>
</ul>
<p>0. C++ Library for a OLED SPI LCD, SSD1331 Driver</p><ol type="1">
<li>Dynamic install-able Raspberry Pi C++ library.</li>
<li>Contrast , dim mode, Invert colour, scroll, rotate, sleep modes supported.</li>
<li>Graphics + print class included.</li>
<li>24 bit colour , 16 bit color, bi-color Bitmaps &amp; sprites supported.</li>
<li>Hardware and Software SPI</li>
<li>Dependency: lgpio Library</li>
<li>NB 'spidev.bufsiz' setting must be greater than largest buffer write size. see Notes section.</li>
<li>SSD1331 96x 64 RGB Dot Matrix OLED/PLED Segment/Common Driver with Controller</li>
</ol>
<ul>
<li>Author: Gavin Lyons</li>
</ul>
<h1><a class="anchor" id="software-9"></a>
Software</h1>
<h2><a class="anchor" id="user-options-1"></a>
User options</h2>
<p>In the example files, there are 3 sections in "Setup()" function where user can make adjustments. The constructor also takes a number of arguments.</p>
<p>0. User Option constructor() Color and contrast settings</p><ol type="1">
<li>User Option Setup() GPIO/SPI Type</li>
<li>User Option Setup() Screen size section <br  />
</li>
<li>User Option Setup() SPI Settings</li>
</ol>
<p><em>User Option 0 Color and contrast settings</em></p>
<p>Here the user can select RGB or BGR mode depending on type of display, They can also set the color contrast levels for the 3 channels (A B and C) for normal and Dim mode. The range is 0-255.</p>
<p><em>User Option 1 SPI TYPE / GPIO</em></p>
<p>This library supports both Hardware SPI and software SPI. The SetupGPIO function is overloaded(2 off one for HW SPI the other for SW SPI). The parameters set for SetupGPIO define which is used.</p>
<p><em>User Option 2 Screen size + Offsets</em></p>
<p>User can adjust screen pixel height, screen pixel width. The function InitScreenSize sets them.</p>
<p><em>User Option 3 SPI Settings</em></p>
<p>InitSPI function is overloaded(2 off, one for HW SPI the other for SW SPI).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">parameter   </th><th class="markdownTableHeadNone">default value   </th><th class="markdownTableHeadNone">note   </th><th class="markdownTableHeadNone">SPi type    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">HWSPI_DEVICE   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">A SPI device, &gt;= 0. which SPI interface to use , ls /dev/spi*   </td><td class="markdownTableBodyNone">Hardware    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HWSPI_CHANNEL   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">A SPI channel, &gt;= 0. Which Chip enable pin to use usually 0 or 1   </td><td class="markdownTableBodyNone">Hardware    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">HWSPI_SPEED   </td><td class="markdownTableBodyNone">1000000   </td><td class="markdownTableBodyNone">The speed of serial communication in bits per second.   </td><td class="markdownTableBodyNone">Hardware    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HWSPI_FLAGS   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">mode 0 for this device   </td><td class="markdownTableBodyNone">Hardware    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GPIO_CHIP_DEVICE   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">gpio chip device &gt;= 0, check ls/dev/gpiochip*   </td><td class="markdownTableBodyNone">both    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SWSPI_CommDelay   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">uS delay for GPIO   </td><td class="markdownTableBodyNone">software   </td></tr>
</table>
<p>The user can adjust if having reliability issues with SW SPI in some setups. This is a microsecond delay in SW SPI GPIO loop. It is set to 0 by default, Increasing it will slow down SW SPI further.</p>
<h2><a class="anchor" id="file-system-5"></a>
File system</h2>
<p>In example folder: The Main.cpp file contains tests showing library functions. A bitmap data file contains data for bi-color bitmaps and icons tests. The color bitmaps used in testing are in bitmap folder, 2 16-bit and 2 24-bit images.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">#   </th><th class="markdownTableHeadNone">example file name   </th><th class="markdownTableHeadNone">Desc    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">hello_world   </td><td class="markdownTableBodyNone">Basic use case    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">hello_world_SWSPI   </td><td class="markdownTableBodyNone">Basic use case software SPI    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">text_graphic_functions   </td><td class="markdownTableBodyNone">Tests text,graphics &amp; function testing    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">bitmap_tests   </td><td class="markdownTableBodyNone">bitmap tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">demos   </td><td class="markdownTableBodyNone">various demos   </td></tr>
</table>
<h2><a class="anchor" id="bitmap-1"></a>
Bitmap</h2>
<p>Functions to support drawing bitmaps</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function Name   </th><th class="markdownTableHeadNone">Colour support   </th><th class="markdownTableHeadNone">Pixel size KiB   </th><th class="markdownTableHeadNone">Note    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">drawIcon   </td><td class="markdownTableBodyNone">bi-colour array   </td><td class="markdownTableBodyNone">(0-96) X 8   </td><td class="markdownTableBodyNone">Data vertically addressed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">drawBitmap   </td><td class="markdownTableBodyNone">bi-colour array   </td><td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">Data horizontally addressed    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">drawBitmap16   </td><td class="markdownTableBodyNone">16 bit color 565 BMP files or array   </td><td class="markdownTableBodyNone">12   </td><td class="markdownTableBodyNone">---&mdash;    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">drawBitmap24   </td><td class="markdownTableBodyNone">24 bit color BMP files or array   </td><td class="markdownTableBodyNone">18   </td><td class="markdownTableBodyNone">Converted by software to 16-bit color    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">drawSprite   </td><td class="markdownTableBodyNone">16 bit color 565 array   </td><td class="markdownTableBodyNone">12   </td><td class="markdownTableBodyNone">Does not use a buffer , draws pixel by pixel , ignores background chosen color   </td></tr>
</table>
<ol type="1">
<li>Bitmap size in kiloBytes = (screenWidth * screenHeight * bitsPerPixel)/(1024 * 8)</li>
<li>Pixel size column assumes 96 by 64 bitmap.</li>
<li>The data array for 1 and 2 is created from image files using file data conversion tool <a href="https://javl.github.io/image2cpp/">link</a></li>
<li>The data array for 3 - 5 is created from BMP files using file data conversion tool <a href="https://notisrac.github.io/FileToCArray/">link</a></li>
<li>For 3 and 4 better just to use bmp files direct from file system see examples.</li>
</ol>
<p>These class functions will return an error code in event of error see API for more details.</p>
<h2><a class="anchor" id="color-codes-1"></a>
Color codes</h2>
<p>For functions that accept a 16 bit color value. There is list of pre-defined colors in the 'colors' folder in doc.</p>
<h1><a class="anchor" id="hardware-9"></a>
Hardware</h1>
<p>Connections as setup in main.cpp test file.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">TFT PinNum   </th><th class="markdownTableHeadNone">Pindesc   </th><th class="markdownTableHeadNone">RPI HW SPI   </th><th class="markdownTableHeadNone">RPI SW SPI    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">GND   </td><td class="markdownTableBodyNone">GND   </td><td class="markdownTableBodyNone">GND    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">VCC   </td><td class="markdownTableBodyNone">VCC 3.3V   </td><td class="markdownTableBodyNone">VCC 3.3V    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">SCLK   </td><td class="markdownTableBodyNone">SPI_CLK   </td><td class="markdownTableBodyNone">GPIO6    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">SDA   </td><td class="markdownTableBodyNone">SPI_MOSI   </td><td class="markdownTableBodyNone">GPIO5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">RESET   </td><td class="markdownTableBodyNone">GPI025   </td><td class="markdownTableBodyNone">GPIO25    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">DC   </td><td class="markdownTableBodyNone">GPIO24   </td><td class="markdownTableBodyNone">GPIO24    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">CS   </td><td class="markdownTableBodyNone">SPI_CE0   </td><td class="markdownTableBodyNone">GPIO21   </td></tr>
</table>
<ol type="1">
<li>Pick any GPIO you want for SW SPI, for HW SPI: reset and DC lines are flexible.</li>
<li>User can select SPI_CE0 or SPI_CE1 for HW SPI</li>
</ol>
<p><a href="https://github.com/gavinlyonsrepo/Display_Lib_RPI/blob/main/extra/images/ssd1331.jpg"><img src="https://github.com/gavinlyonsrepo/Display_Lib_RPI/blob/main/extra/images/ssd1331.jpg" alt="Image SSD" class="inline"/></a></p>
<h1><a class="anchor" id="output-6"></a>
Output</h1>
<p><a href="https://github.com/gavinlyonsrepo/Display_Lib_RPI/blob/main/extra/images/ssd1331output.jpg"><img src="https://github.com/gavinlyonsrepo/Display_Lib_RPI/blob/main/extra/images/ssd1331output.jpg" alt=" demo pic 2" class="inline"/></a></p>
<h1><a class="anchor" id="notes-1"></a>
Notes</h1>
<h2><a class="anchor" id="spidev-buf-size-1"></a>
spidev buf size</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Device or library   </th><th class="markdownTableHeadNone">maximum SPI transaction size bytes   </th><th class="markdownTableHeadNone">where defined    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lgpio   </td><td class="markdownTableBodyNone">65536   </td><td class="markdownTableBodyNone">LG_MAX_SPI_DEVICE_COUNT in lgpio.h    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Display_lib_RPI   </td><td class="markdownTableBodyNone">2 &lt;-&gt; 65536(default)   </td><td class="markdownTableBodyNone">Display_SPI_BLK_SIZE    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Raspberry pis   </td><td class="markdownTableBodyNone">set same or bigger as Display_SPI_BLK_SIZE   </td><td class="markdownTableBodyNone">/boot/firmware/cmdline.txt spidev.bufsiz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">other SBC   </td><td class="markdownTableBodyNone">set same or bigger as Display_SPI_BLK_SIZE   </td><td class="markdownTableBodyNone">???   </td></tr>
</table>
<p>The maximum SPI transaction size that 'lgpio' can handle by default is 65536 bytes.(see LG_MAX_SPI_DEVICE_COUNT in lgpio.h) So this is also the maximum transaction size of Display_lib_RPI, if more than that needs to be sent it is sent in blocks of Display_SPI_BLK_SIZE(default 65536) bytes. Certain color 16-bit 'Display_lib_RPI' functions use buffered writes, the ones that draw bitmaps, write fonts, fill rectangles, clear screen, etc. User can also change and view maximum SPI transaction size( Display_SPI_BLK_SIZE) of 'Display_lib_RPI' by using getDisplaySPIBlockSize() and setDisplaySPIBlockSize() functions, by default it is 65536. Due not set it higher than this or 'lgppio' will give an spi Write error. In order for buffered writes to work the spidev.buf size of users SBC must bigger than or equal Display_SPI_BLK_SIZE(max and default 65536), but no bigger than 65536.</p>
<p><em>On Raspberry Pi's SBC</em></p>
<p>spidev bufsiz defines the number of bytes that the SPI driver will use as a buffer for data transfers. To check the spidev buf size setting on your device run command:</p>
<div class="fragment"><div class="line">cat /sys/module/spidev/parameters/bufsiz</div>
</div><!-- fragment --><p>If it is lower than 65536 you can change it by adding this to the start of line in file /boot/firmware/cmdline.txt. Make sure everything is on one line and there is space ' ' between this parameter and next one. Then reboot machine. Verify again by running last cat command above</p>
<div class="fragment"><div class="line">spidev.bufsiz=65536</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
